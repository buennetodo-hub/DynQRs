<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title></title>
<style>
body { background-color: #fff; text-align: center; margin-top: 100px; }
.lds-hourglass { /* change color here */ color: #000000 }
.lds-hourglass, .lds-hourglass:after { box-sizing: border-box; }
.lds-hourglass { display: inline-block; position: relative; width: 80px; height: 80px; }
.lds-hourglass:after { content: " "; display: block; border-radius: 50%; width: 0; height: 0; margin: 8px; box-sizing: border-box; border: 32px solid currentColor; border-color: currentColor transparent currentColor transparent; animation: lds-hourglass 1.2s infinite; }
@keyframes lds-hourglass { 0% { transform: rotate(0); animation-timing-function: cubic-bezier(0.55, 0.055, 0.675, 0.19); } 50% { transform: rotate(900deg); animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1); } 100% { transform: rotate(1800deg); } }
</style>
</head>
<body>
<script>
const AS_URL_BASE = "https://script.google.com/macros/s/AKfycbwQtDWavPfbnw1PDAPLhMSVxtgPwyIYlA2KvE4aHcfz5N30YOgheou1BPm-UHBrBuF5eQ/exec";

// --- FUNCIONES PARA MANEJAR COOKIES ---

// Función para establecer una cookie
function setCookie(name, value, days) {
    let expires = "";
    if (days) {
        let date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
    }
    // Se establece una cookie que dura 365 días
    document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax; Secure";
}

// Función para obtener el valor de una cookie
function getCookie(name) {
    let nameEQ = name + "=";
    let ca = document.cookie.split(';');
    for(let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
}

// Función para generar un ID único (UUID)
function generateUUID() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
    return v.toString(16);
  });
}

// --- LÓGICA PRINCIPAL ---

// Obtener o crear el identificador de usuario desde la cookie
let userId = getCookie('userId');
if (!userId) {
  userId = generateUUID();
  // Se establece la cookie para que expire en 365 días
  setCookie('userId', userId, 365);
}

// Extraer el parámetro 'k' de la URL actual
var url = document.location.href;
var k = url.substr(url.lastIndexOf("k=")+2);

if(k) {
  // Adjuntar la clave (k) y el identificador de usuario (uid) a la URL de la solicitud
  fetch(AS_URL_BASE + '?k=' + k + '&uid=' + userId)
    .then(r => r.text())
    .then((r) => {
      console.log(r);
      // Si el script de Google devuelve una URL, redirigir
      if(r){
        document.location.replace(r);
      }
    })
    .catch(err => console.log(err))
}
</script>
<div class="lds-hourglass"></div>
</body>
</html>
